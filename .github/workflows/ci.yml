name: Kyber Tests

on:
  push:
    branches: [ main, master, dev ]
  pull_request:
    branches: [ main, master, dev ]

jobs:
  test:
    name: NTT Tests
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ðŸ”§ Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential

    - name: â„¹ï¸ System information
      run: |
        echo "=== Compiler ==="
        gcc --version
        echo "=== Make ==="
        make --version
        echo "=== Project structure ==="
        ls -la
        echo "=== src/ content ==="
        ls -la src/
        echo "=== include/ content ==="
        ls -la include/
        echo "=== tests/ content ==="
        ls -la tests/

    - name: ðŸ—ï¸ Build project
      run: make

    - name: ðŸš€ Run NTT tests
      run: make test_ntt

    - name: ðŸ“Š Test summary
      if: always()
      run: |
        echo "### ðŸ§ª NTT Test Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Platform:** ubuntu-latest" >> $GITHUB_STEP_SUMMARY
        echo "**Compiler:** $(gcc --version | head -n1)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ -f test_ntt ]; then
          echo "âœ… Build successful" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Tests executed successfully" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ Build failed" >> $GITHUB_STEP_SUMMARY

    - name: ðŸ§¹ Cleanup
      if: always()
      run: make clean
